# Make 10 ゲーム仕様書

## 概要
プレイヤーが4つのランダムな数字と基本的な算術演算を使って数字の10を作る数学パズルゲーム。

## ゲームルール
1. プレイヤーは4つのランダムな数字（0-9）を受け取る
2. プレイヤーは演算子（+、-、×、÷）を使って任意の2つの数字を組み合わせることができる
3. 目標：4つの数字をすべて使って10を作る
4. 演算は連鎖させることができる（例：(1+2) × 3 + 1 = 10）
5. 各数字は必ず1回ずつ使用する

## ゲームフロー
```
ゲーム開始
    ↓
4つのランダムな数字を生成
    ↓
数字と演算UIを表示
    ↓
プレイヤーが演算を実行
    ↓
結果が10かチェック
    ↓
Yes: "ステージクリア"表示 → 次のステージ
No: ゲーム続行
```

## ユーザーインターフェース要件

### メインゲーム画面
- 4つのランダム数字を目立つように表示
- 演算ボタン：+、-、×、÷
- 現在の計算式表示
- 同じ数字でやり直すリセットボタン
- スコア/ステージカウンター

### ステージクリアポップアップ
- "ステージクリア！"メッセージ
- 現在のステージ番号
- "次へ"ボタンで進行
- オプション：ステージクリア時間

## 技術要件

### アーキテクチャ
- **フレームワーク**：Rust with Bevyゲームエンジン
- **開発アプローチ**：テスト駆動開発（TDD）
- **テスト**：ゲームロジックのユニットテスト、UIの統合テスト

### コアコンポーネント

#### ゲーム状態管理
- `GameState` enum：`Playing`、`StageClear`、`GameOver`
- ステージ進行システム
- スコア追跡

#### 数字生成
- ランダム4桁生成（各0-9）
- 解答可能な組み合わせを保証（少なくとも1つの有効解が存在）

#### 計算エンジン
- 数式パーサー
- 4つの数字が正確に1回ずつ使用されていることの検証
- 結果評価システム

#### UIシステム
- 数字表示システム
- 演算入力システム
- ポップアップ管理システム

## テストケース

### ユニットテスト
1. **数字生成**
   - ランダム数字生成のテスト
   - 4桁が生成されることの確認
   - 数字が有効範囲（0-9）内であることの確認

2. **計算ロジック**
   - 基本算術演算のテスト
   - 式解析のテスト
   - 数字使用検証のテスト
   - 結果評価のテスト

3. **ゲーム状態**
   - 状態遷移のテスト
   - ステージ進行のテスト
   - 勝利条件検出のテスト

### 統合テスト
1. **完全なゲームフロー**
   - 開始からステージクリアまでの完全なゲームサイクルのテスト
   - 複数ステージのテスト
   - UI相互作用のテスト

### テストシナリオ例
- 入力：[1, 2, 3, 4] → 有効：(1+2+3) × 4 = 24 ≠ 10、無効
- 入力：[1, 2, 3, 4] → 有効：(4-1) × 2 + 3 = 9 ≠ 10、無効  
- 入力：[1, 2, 3, 4] → 有効：4 × (3-1) + 2 = 10 ✓
- 入力：[2, 5, 5, 0] → 有効：2 × 5 + 0 × 5 = 10 ✓

## 実装フェーズ

### フェーズ1：コアロジック（TDD）
- テスト付き数字生成の実装
- テスト付き計算エンジンの実装
- テスト付きゲーム状態管理の実装

### フェーズ2：基本UI
- メインゲーム画面の作成
- 数字表示の実装
- 演算ボタンの追加

### フェーズ3：ゲームフロー
- ステージクリア検出の実装
- ポップアップシステムの追加
- ステージ進行の追加

### フェーズ4：仕上げ
- アニメーションとエフェクトの追加
- UI/UXの改善
- 効果音の追加（オプション）

## 成功基準
- すべてのテストが通る
- プレイヤーが複数ステージを正常にプレイできる
- UIが直感的で応答性がある
- ゲームが解答を正しく検証する
- ステージ進行がスムーズに動作する